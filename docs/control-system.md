# 操作体系仕様

## 概要

この操作体系は、ぷよ操作の高速化とミスの削減を目的としています。

## UI構成

### フィールド
- 6列 x 12行のぷよフィールド
- 右寄せ配置（右利き用）
- 左マージン: 4px、右マージン: 20px

### 操作エリア
- フィールド下部に配置
- フィールドと同じ幅（6列分 + ボーダー）
- 高さ: セルサイズ x 3
- 6列の区切り線でタップ位置を視覚化

### 予告ぷよ（NEXT）
- フィールド右上にオーバーレイ表示
- 2つ先まで表示

## 操作方法

### 基本操作フロー

1. **タッチ開始**: 操作エリア内でタッチ
   - タッチした列に軸ぷよ（下側のぷよ）が移動
   - サテライト（上側のぷよ）は上向きに初期化

2. **スワイプ**: 手を離さずにスワイプ
   - サテライトの向きを変更

3. **リリース**: 手を離す
   - 配置確定状態: ハードドロップ（即座に落下・固定）
   - キャンセル待ち状態: 操作キャンセル（中央に戻る）

### スワイプ方向とサテライト配置

| スワイプ方向 | サテライト位置 |
|-------------|--------------|
| 上スワイプ   | 下           |
| 下スワイプ   | 上           |
| 左スワイプ   | 左           |
| 右スワイプ   | 右           |

### キャンセル操作

スワイプ後に元の位置（タッチ開始位置の近く）に戻すと「キャンセル待ち状態」になります。
この状態で手を離すと、操作がキャンセルされ、ぷよは中央（3列目）に戻ります。

## 状態遷移

```
初期状態 (idle)
    ↓ タッチ開始
操作中状態 (touching)
    ↓ スワイプ（閾値超過）
配置確定状態 (swiped)
    ├→ 手を離す → ハードドロップ → 初期状態
    └→ 元の位置に戻す
         ↓
キャンセル待ち状態 (cancelPending)
    └→ 手を離す → キャンセル → 初期状態
```

## 閾値設定

- スワイプ検出閾値: 20px
- キャンセル判定閾値: 15px

## 技術的詳細

### 関連ファイル

- `src/input/ControlAreaInput.tsx`: 操作エリアコンポーネント
- `src/store/actions.ts`: SET_COLUMN, SET_ROTATION アクション
- `src/store/gameStore.ts`: アクションハンドラ
- `src/logic/puyo.ts`: setColumn, setRotation 関数

### アクション

- `SET_COLUMN`: 軸ぷよの列を直接設定
- `SET_ROTATION`: サテライトの向き（0:上, 1:右, 2:下, 3:左）を直接設定
- `HARD_DROP`: 即座に落下・固定
